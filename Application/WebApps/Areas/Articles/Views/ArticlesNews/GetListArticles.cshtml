 @using WebApps.CommonFunction
@using ObjectInfos;
@using BussinessFacade.ModuleMemoryData
@{
    ViewBag.Title = "Danh sách tin";
    Layout = "~/ViewsShared/_Layout.cshtml";

}
<style>
    .div-search-title > div {
        width: 150px;
    }

    .ms-parent {
        margin: 0px 3px;
    }

    .ms-choice {
        height: 30px;
    }
</style>

<div class="divCover">
    <div class="d-nav">
        <img src="~/Content/icons/Body-icon-home.png" /> Tin tức
        <span class="red">></span>
        <a href="/quan-ly-tin/danh-sach-tin">Quản lý tin</a>
    </div>
</div>
<div class="divCover">
    <div class="classLine">
    </div>
</div>

<div class="d-main">
    <div class="divCover">
        <input type="hidden" value="MODIFIED_DATE" id="colSorted" />
        <input type="hidden" value="DESC" id="SortType" />
        <input type="hidden" value="" id="OptionSorting" />
    </div>

    <div class="divCover" id="div-search-simple" style="margin-top:10px">

        <div class="div-search-ad">
            <div class="div-search-title">
                <div style="width: 120px">Danh mục</div>
            </div>
            <div>
                <div style="width:200px">
                    <select id="cboSearchWikiCatalogue">
                        <option value="ALL"> Tất cả </option>
                        @if (ViewBag.lstCategory != null)
                        {
                            foreach (AllCodeInfo item in ViewBag.lstCategory)
                            {
                                <option value="@item.CdVal">@item.Content</option>
                            }
                        }
                    </select>
                </div>
            </div>
            <div class="div-search-title">
                <div style="width: 120px">Tiêu đề</div>
            </div>
            <div class="div-search-content">
                <div>
                    <input type="text" id="txtTieuDeBaiViet" data-controlcondition="TRUE" />
                </div>
            </div>
        </div>
    </div>

    <div class="divCover">
        <div class="div-search-btn" style="width:450px;">
            <input type="button" value="Tìm kiếm" id="btnSearch" class="btn-default" />
            @* Nếu là viết bài mới  *@
            @if (ViewBag.Status == Common.Status.VietBai)
            {
                <a href="/quan-ly-tin/soan-bai-viet"><input type="button" value="Thêm bài viết" class="btn-default" style="width: 125px;" /></a>
            }
        </div>
    </div>

    <div class="divCover">
        <div id="divTableObjects">
            @Html.Partial("~/Areas/Articles/Views/ArticlesNews/_PartialViewTable.cshtml")
        </div>
    </div>

</div>

<script>

    $("#btnSearch").click(function () {
        funcSearch(1,0);
    });


    function funcSearch(page ,pType) {
        try {
            var danhmuc = $("#cboSearchWikiCatalogue").val();
            var tieude = $("#txtTieuDeBaiViet").val();

            if (CheckSessionTimeOut() == false) {
                return false;
            }
            $.ajax({
                url: "/quan-ly-tin/tim-kiem-tin",
                type: "GET",
                data: {
                    pCategory: danhmuc,
                    pTitile: tieude,
                    pPage: page 
                },
                async: true, cache: false, traditional: true,
                enctype: 'multipart/form-data', async: false, headers: { "cache-control": "no-cache" },
                beforeSend: function () {
                    CreateRollingWaitingIcon(true);
                },
                success: function (data)
                {
                    $("#divTableObjects").html(data);
                },
                error: function (e) {
                    CreateRollingWaitingIcon(false);
                    console.log(e);
                }
            });
        } catch (e) {

        }

    }
    function funcDelArticles(pID) {

        nvsConfirm(null, "Bạn có chắc chắn muốn xóa bài viết này không?", function () {
            console.log('vao day');
            $.ajax({
                url: "/quan-ly-tin/xoa-bai-viet",
                type: "GET",
                data: {
                    pIDArticles: pID
                },
                async: true, cache: false, traditional: true,
                enctype: 'multipart/form-data', async: false, headers: { "cache-control": "no-cache" },
                beforeSend: function () {
                    CreateRollingWaitingIcon(true);
                },
                success: function (data) {
                    CreateRollingWaitingIcon(false);
                    if (data.success == "-1") {
                        jError("Lỗi check lại kết nối tới server");
                        return false;
                    }
                    else {
                        jAlert('Xóa bài viết thành công!', "THÔNG BÁO", function () {
                            SearchDDSHCN(1, 1);
                        });
                    }
                },
                error: function (e) {
                    CreateRollingWaitingIcon(false);
                    console.log(e);
                }
            });
        });
    }

    function jsPaging(page) {
        funcSearch(page, 0);
    }
</script>